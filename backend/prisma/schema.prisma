// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  STUDENT
  FACULTY
  ADMIN
}

enum Department {
  CE
  CSE
  IT
}

enum Institute {
  CSPIT
  DEPSTAR
}

enum Status {
  PENDING
  IN_PROGRESS
  COMPLETED
}

model User {
  id         String     @id @unique
  email      String     @unique
  name       String
  password   String
  role       UserRole   @default(STUDENT)
  department Department
  institute  Institute
  Student    Student[]  @relation("StudentRef")
  Faculty    Faculty[]  @relation("FacultyRef")
  Admin      Admin[]    @relation("AdminRef")
}

model Student {
  id                 Int          @id @unique
  user               User         @relation("StudentRef", fields: [userId], references: [id])
  userId             String       @unique
  current_study_year String
  passing_year       String
  batch              String
  team               Team         @relation("TeamMembers", fields: [teamId], references: [id])
  teamId             Int
  marks              Mark?        @relation("StudentMarks")
  evaluations        Evaluation[] @relation("StudentEvaluations")
  teamLeader         Team?        @relation("TeamLeader")
}

model Team {
  id            Int       @id @unique
  name          String
  students      Student[] @relation("TeamMembers")
  project       Project   @relation(fields: [project_id], references: [id])
  project_id    Int
  leader        Student   @relation("TeamLeader", fields: [leaderId], references: [id])
  leaderId      Int       @unique
  studentsCount Int       @default(0)
}

model Project {
  id          Int      @id @unique
  title       String
  description String
  technology  String[]
  status      Status
  teams       Team[]
}

model Faculty {
  id          Int          @id @unique
  user        User         @relation("FacultyRef", fields: [userId], references: [id])
  userId      String       @unique
  department  Department
  evaluations Evaluation[]
}

model Admin {
  id         Int        @id @unique
  user       User       @relation("AdminRef", fields: [userId], references: [id])
  userId     String     @unique
  department Department
}

model Mark {
  id          Int          @id @unique
  internal1   Int
  internal2   Int?
  external    Int?
  student     Student      @relation("StudentMarks", fields: [studentId], references: [id])
  studentId   Int          @unique
  evaluations Evaluation[]
}

model Evaluation {
  id             Int      @id @unique
  marks          Mark?    @relation(fields: [marksId], references: [id])
  marksId        Int?
  student        Student  @relation("StudentEvaluations", fields: [studentId], references: [id])
  studentId      Int
  faculty        Faculty  @relation(fields: [facultyId], references: [id])
  facultyId      Int
  evaluationDate DateTime @default(now())
}
